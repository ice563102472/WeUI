<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<!--  AutoGenerated by lindzh  2016年12月15日 16:54 -->
<mapper namespace="com.linda.rpc.webui.dao.HostInfoDao">

	<resultMap id="HostInfoResultMap" type="com.linda.rpc.webui.pojo.HostInfo">
		<id property="id" column="id"/>
		<result property="host" column="host_ip"/>
		<result property="port" column="host_port"/>
		<result property="appId" column="app_id"/>
		<result property="token" column="token"/>
		<result property="weight" column="weight"/>
		<result property="wantWeight" column="want_weight"/>
		<result property="status" column="host_status"/>
		<result property="time" column="up_time"/>
	</resultMap>
	
	<insert id="addHostInfo" useGeneratedKeys="true" keyProperty="id" parameterType="com.linda.rpc.webui.pojo.HostInfo">
		insert into host_info(host_ip,host_port,app_id,token,weight,want_weight,host_status,up_time)
		 values(#{host},#{port},#{appId},#{token},#{weight},#{wantWeight},#{status},#{time})
	</insert>
	
	<select id="getById" resultMap="HostInfoResultMap">
		select * from host_info where id=#{id}
	</select>
	
	<update id="updateById" parameterType="com.linda.rpc.webui.pojo.HostInfo">
		update host_info set host_ip=#{obj.host},host_port=#{obj.port},app_id=#{obj.appId},token=#{obj.token},
		weight=#{obj.weight},want_weight=#{obj.wantWeight},host_status=#{obj.status},up_time=#{obj.time}
		where id=#{obj.id}
	</update>
	
	<delete id="deleteById">
		delete from host_info where id=#{id}
	</delete>
	

	<select id="getListByHost" resultMap="HostInfoResultMap">
		select * from host_info where
		host_ip=#{host}
		order by id desc limit #{limit} offset #{offset}
	</select>
	
	<select id="getCountByHost" resultType="long">
		select count(*) from host_info where 
		host_ip=#{host}
	</select>
	
	
	<select id="getListByAppIdAndStatus" resultMap="HostInfoResultMap">
		select * from host_info where
		app_id=#{appId}
		<if test="status&gt;-1">
		and host_status=#{status}
		</if>
		order by id desc limit #{limit} offset #{offset}
	</select>
	
	<select id="getCountByAppIdAndStatus" resultType="long">
		select count(*) from host_info where 
		app_id=#{appId}
		<if test="status&gt;-1">
			and host_status=#{status}
		</if>
	</select>

	<select id="getAppHost" resultMap="HostInfoResultMap">
		select * from host_info where
		app_id=#{appId} and host_ip=#{host} and host_port=#{port}
	</select>

	<update id="updateStatus">
		update host_info set host_status=#{status} where 1=1
	</update>

	<select id="getListByStatus" resultMap="HostInfoResultMap">
		select * from host_info where
		host_status=#{status}
	</select>

	<select id="getProviderListByStatus" resultMap="HostInfoResultMap">
		select * from host_info where
		host_status=#{status} and host_port&gt;1000
	</select>
	
	<select id="getListByHostAndPort" resultMap="HostInfoResultMap">
		select * from host_info where
		host_ip=#{host} and host_port=#{port}
	</select>

	<select id="getByAppAndIp" resultMap="HostInfoResultMap">
		select * from host_info where
		app_id=#{appId} and host_ip=#{host}
	</select>



	<select id="getProviderListByServiceId" resultMap="HostInfoResultMap">
		select * from host_info
		where id in(select distinct(host_id) from service_provider_info where service_id=#{serviceId})
	</select>


	<select id="getConsumerListByServiceId" resultMap="HostInfoResultMap">
		select * from host_info
		where id in(select distinct(consumer_host_id) from service_consumer_info where service_id=#{serviceId})
	</select>


	<select id="getProviderListByAppId" resultMap="HostInfoResultMap">
		select * from host_info where app_id=#{appId}
	</select>


	<select id="getConsumerListByAppId" resultMap="HostInfoResultMap">
		select * from host_info
		where id in(select distinct(consumer_host_id) from service_consumer_info where service_app_id=#{appId})
	</select>

	<select id="getListByAppIdWithPage" resultMap="HostInfoResultMap">
		select * from host_info
		<if test="appId&gt;0">
			where app_id=#{appId}
		</if>
		order by id desc
	</select>

	<select id="getCountByAppId" resultType="long">
		select count(1) from host_info
		<if test="appId&gt;0">
			where app_id=#{appId}
		</if>
	</select>
	
</mapper>